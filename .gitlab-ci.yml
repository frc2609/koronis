firebase:
  image: rambabusaravanan/firebase
  stage: deploy
  cache:
    paths:
      - node_modules/
    key: "$CI_BUILD_REPO"
  script:
    - npm install
    - CI=false npm run build
    - firebase use koronis-scouting-system --token $FIREBASE_TOKEN
    - firebase deploy --only hosting -m "Pipe $CI_PIPELINE_ID Build $CI_BUILD_ID" --token $FIREBASE_TOKEN
  artifacts:
    paths:
      - build
  only:
    - master

pages:
  image: node:10.22.0-jessie
  stage: deploy
  script:
    - rm -rf *
    - mkdir public
    - cd public
    - mkdir dev
    - mkdir latest
    - cd ..
    - git clone -b dev https://gitlab.com/koronis-scouting-system/kss-client dev
    - git clone -b master https://gitlab.com/koronis-scouting-system/kss-client prod
    - cd dev
    - npm install
    - CI=false npm run devbuild
    - cd ../prod
    - npm install
    - CI=false npm run build
    - cd ..
    - mv dev/build/* public/dev
    - mv prod/build/* public/latest
  artifacts:
    paths:
      - public
  only:
    - master
    - dev
